<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Live Trading Sessions</title>

<style>
  :root{
    /* Match your Notion dark background (from screenshot) */
    --bg: #191919;

    --text: rgba(255,255,255,.92);
    --muted: rgba(255,255,255,.62);
    --stroke: rgba(255,255,255,.10);

    --open: #28E6A5;
    --closed: #FF4D6D;

    --radius: 16px;
    --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
    --sans: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
  }

  *{ box-sizing:border-box; }

  /* Notion embed iframe can be white; paint over it */
  html, body{
    margin:0;
    padding:0;
    height:100%;
    background: var(--bg) !important;
  }

  body{
    color: var(--text);
    font-family: var(--sans);
    padding: 12px;
  }

  .wrap{
    width: min(980px, 100%);
    margin: 0 auto;
  }

  .panel{
    background: var(--bg);
    border: 1px solid rgba(255,255,255,.08);
    border-radius: var(--radius);
    overflow:hidden;
  }

  .header{
    display:flex;
    justify-content:space-between;
    align-items:flex-start;
    gap:12px;
    padding: 12px;
    border-bottom: 1px solid rgba(255,255,255,.07);
  }

  .title h1{
    margin:0;
    font-size: 14px;
    font-weight: 800;
    letter-spacing:.2px;
  }

  .chip{
    font-family: var(--mono);
    font-size: 12px;
    color: rgba(255,255,255,.88);
    padding: 7px 10px;
    border-radius: 999px;
    border:1px solid rgba(255,255,255,.12);
    background: rgba(0,0,0,.22);
    white-space:nowrap;
    min-width: 86px;
    text-align:center;
  }

  .grid{
    display:grid;
    grid-template-columns: repeat(3, minmax(0, 1fr));
    gap: 10px;
    padding: 12px;
  }
  @media (max-width: 760px){
    .grid{ grid-template-columns: 1fr; }
  }

  .card{
    border: 1px solid rgba(255,255,255,.10);
    border-radius: 14px;
    padding: 12px;
    background: rgba(255,255,255,.05);
    backdrop-filter: blur(10px);
    -webkit-backdrop-filter: blur(10px);
  }

  .top{
    display:flex;
    justify-content:space-between;
    align-items:center;
    gap:10px;
  }

  .left{
    display:flex;
    align-items:center;
    gap:10px;
    min-width:0;
  }

  .dot{
    width:10px; height:10px;
    border-radius:50%;
    background: var(--closed);
    box-shadow: 0 0 0 4px rgba(255,77,109,.14);
    flex:0 0 auto;
  }

  .names{
    display:flex;
    flex-direction:column;
    gap:2px;
    min-width:0;
  }
  .names b{
    font-size: 13px;
    white-space:nowrap;
    overflow:hidden;
    text-overflow:ellipsis;
  }
  .names span{
    font-size: 11px;
    color: var(--muted);
    white-space:nowrap;
    overflow:hidden;
    text-overflow:ellipsis;
  }

  .status{
    font-family: var(--mono);
    font-size: 11px;
    padding: 6px 10px;
    border-radius: 999px;
    border:1px solid rgba(255,255,255,.12);
    background: rgba(0,0,0,.18);
    white-space:nowrap;
  }

  .open .dot{
    background: var(--open);
    box-shadow: 0 0 0 4px rgba(40,230,165,.14);
  }
  .open .status{
    color: rgba(40,230,165,.95);
    border-color: rgba(40,230,165,.22);
    background: rgba(40,230,165,.10);
  }
  .closed .status{
    color: rgba(255,77,109,.95);
    border-color: rgba(255,77,109,.22);
    background: rgba(255,77,109,.08);
  }

  .footer{
    padding: 10px 12px 12px 12px;
    border-top: 1px solid rgba(255,255,255,.07);
    color: var(--muted);
    font-size: 11px;
    display:flex;
    justify-content:space-between;
    gap:10px;
  }

  .pill{
    font-family: var(--mono);
    padding: 2px 8px;
    border-radius: 999px;
    border:1px solid rgba(255,255,255,.10);
    background: rgba(0,0,0,.18);
    color: rgba(255,255,255,.75);
    display:inline-block;
    white-space:nowrap;
  }
</style>
</head>

<body>
<div class="wrap">
  <div class="panel">
    <div class="header">
      <div class="title">
        <h1>Live Trading Sessions</h1>
      </div>
      <div class="chip" id="etNow">ET --:--</div>
    </div>

    <div class="grid" id="grid"></div>

    <!-- No countdown and no "Next" text. Only a static footer label. -->
    <div class="footer">
      <div>All times ET (America/Toronto)</div>
      <div class="pill">OPEN/CLOSED only</div>
    </div>
  </div>
</div>

<script>
  const TZ = "America/Toronto";

  // Killzones (ET)
  const WINDOWS = [
    { key:"asia",   name:"Asia Range",      start:"20:00", end:"00:00" },
    { key:"london", name:"London Killzone", start:"02:00", end:"05:00" },
    { key:"ny",     name:"NY Killzone",     start:"09:30", end:"11:00" }
  ];

  const grid = document.getElementById("grid");

  function getPartsInTZ(tz, date=new Date()){
    const parts = new Intl.DateTimeFormat("en-GB", {
      timeZone: tz, hour12:false,
      hour:"2-digit", minute:"2-digit", second:"2-digit"
    }).formatToParts(date);

    const get = (type) => parts.find(p => p.type === type)?.value ?? "00";
    return {
      hour: Number(get("hour")),
      minute: Number(get("minute")),
      second: Number(get("second")),
      hh: get("hour"),
      mm: get("minute")
    };
  }

  function minsInTZ(tz, date=new Date()){
    const p = getPartsInTZ(tz, date);
    return p.hour * 60 + p.minute;
  }

  function parseHM(hm){
    const [h,m] = hm.split(":").map(Number);
    return h*60 + m;
  }

  // Display times "hours only" (minutes intentionally removed)
  function hourLabel(hm){
    const [H] = hm.split(":").map(Number);
    const suffix = H >= 12 ? "PM" : "AM";
    const h12 = ((H + 11) % 12) + 1;
    return `${h12} ${suffix}`;
  }

  function isOpen(win){
    const nowM = minsInTZ(TZ);
    const startM = parseHM(win.start);
    const endM   = parseHM(win.end);

    if(endM > startM) return nowM >= startM && nowM < endM;
    return (nowM >= startM || nowM < endM); // crosses midnight
  }

  function build(){
    grid.innerHTML = "";
    for(const w of WINDOWS){
      const el = document.createElement("div");
      el.className = "card closed";
      el.id = `card-${w.key}`;
      el.innerHTML = `
        <div class="top">
          <div class="left">
            <div class="dot"></div>
            <div class="names">
              <b>${w.name}</b>
              <span>${hourLabel(w.start)}â€“${hourLabel(w.end)}</span>
            </div>
          </div>
          <div class="status" id="status-${w.key}">CLOSED</div>
        </div>
      `;
      grid.appendChild(el);
    }
  }

  function updateClock(){
    const p = getPartsInTZ(TZ);
    document.getElementById("etNow").textContent = `ET ${p.hh}:${p.mm}`;
  }

  // Backend logic controls OPEN/CLOSED (no countdown visible)
  function updateSessions(){
    for(const w of WINDOWS){
      const openNow = isOpen(w);
      const card = document.getElementById(`card-${w.key}`);
      const status = document.getElementById(`status-${w.key}`);

      card.classList.toggle("open", openNow);
      card.classList.toggle("closed", !openNow);
      status.textContent = openNow ? "OPEN" : "CLOSED";
    }
  }

  build();
  updateClock();
  updateSessions();

  // ET chip updates every second so it never lags a minute
  setInterval(updateClock, 1000);

  // Session updates quietly in the background
  setInterval(updateSessions, 15000);
</script>
</body>
</html>
