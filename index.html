<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Trading Sessions</title>

<style>
  :root{
    --text: rgba(255,255,255,.92);
    --muted: rgba(255,255,255,.60);
    --stroke: rgba(255,255,255,.10);

    --ok: #28E6A5;
    --bad:#FF4D6D;

    /* Card background: set to transparent if you want 100% see-through */
    --card: rgba(0,0,0,.28);

    --radius: 16px;
    --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
    --sans: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
  }

  *{ box-sizing:border-box; }

  /* Force true transparency for Notion iframe */
  html, body{
    margin:0;
    padding:0;
    background: transparent !important;
  }

  body{
    color: var(--text);
    font-family: var(--sans);
    padding: 12px;
  }

  .wrap{
    width: min(980px, 100%);
    margin: 0 auto;
  }

  .panel{
    background: transparent !important;
    border: 1px solid var(--stroke);
    border-radius: var(--radius);
    overflow:hidden;
  }

  .header{
    display:flex;
    justify-content:space-between;
    align-items:flex-start;
    gap:12px;
    padding: 12px;
    border-bottom: 1px solid rgba(255,255,255,.07);
    background: transparent;
  }

  .title h1{
    margin:0;
    font-size: 14px;
    font-weight: 800;
    letter-spacing:.2px;
  }
  .title p{
    margin:4px 0 0 0;
    font-size: 12px;
    color: var(--muted);
  }

  .chip{
    font-family: var(--mono);
    font-size: 12px;
    color: rgba(255,255,255,.82);
    padding: 7px 10px;
    border-radius: 999px;
    border:1px solid rgba(255,255,255,.12);
    background: rgba(0,0,0,.22);
    white-space:nowrap;
  }

  .grid{
    display:grid;
    grid-template-columns: repeat(3, minmax(0, 1fr));
    gap: 10px;
    padding: 12px;
  }
  @media (max-width: 760px){
    .grid{ grid-template-columns: 1fr; }
  }

  .card{
    border: 1px solid rgba(255,255,255,.10);
    border-radius: 14px;
    padding: 12px;
    background: var(--card);
    backdrop-filter: blur(10px);
    -webkit-backdrop-filter: blur(10px);
  }

  .top{
    display:flex;
    justify-content:space-between;
    align-items:center;
    gap:10px;
  }

  .left{
    display:flex;
    align-items:center;
    gap:10px;
    min-width:0;
  }

  .dot{
    width:10px; height:10px;
    border-radius:50%;
    background: var(--bad);
    box-shadow: 0 0 0 4px rgba(255,77,109,.14);
    flex:0 0 auto;
  }

  .names{
    display:flex;
    flex-direction:column;
    gap:2px;
    min-width:0;
  }
  .names b{
    font-size:13px;
    white-space:nowrap;
    overflow:hidden;
    text-overflow:ellipsis;
  }
  .names span{
    font-size:11px;
    color: var(--muted);
    white-space:nowrap;
    overflow:hidden;
    text-overflow:ellipsis;
  }

  .status{
    font-family: var(--mono);
    font-size: 11px;
    padding: 6px 10px;
    border-radius: 999px;
    border:1px solid rgba(255,255,255,.12);
    background: rgba(0,0,0,.22);
    white-space:nowrap;
  }

  .mid{
    display:flex;
    justify-content:space-between;
    align-items:flex-end;
    gap: 10px;
    margin-top: 12px;
  }

  .clock{
    font-family: var(--mono);
    font-size: 26px;
    letter-spacing:.4px;
    line-height:1;
  }

  .cd{
    text-align:right;
    color: var(--muted);
    font-size: 11px;
    line-height:1.35;
  }
  .cd .big{
    margin-top: 2px;
    font-family: var(--mono);
    color: rgba(255,255,255,.88);
    font-size: 12px;
  }

  .windows{
    margin-top: 10px;
    padding-top: 10px;
    border-top: 1px solid rgba(255,255,255,.07);
    display:flex;
    flex-direction:column;
    gap:6px;
    font-size: 11px;
    color: var(--muted);
  }

  .line{
    display:flex;
    justify-content:space-between;
    gap:10px;
  }
  .pill{
    font-family: var(--mono);
    font-size: 11px;
    color: rgba(255,255,255,.82);
    background: rgba(0,0,0,.22);
    border: 1px solid rgba(255,255,255,.10);
    padding: 2px 8px;
    border-radius: 999px;
    white-space:nowrap;
  }

  .open .dot{
    background: var(--ok);
    box-shadow: 0 0 0 4px rgba(40,230,165,.14);
  }
  .open .status{
    color: rgba(40,230,165,.95);
    border-color: rgba(40,230,165,.22);
    background: rgba(40,230,165,.10);
  }
  .closed .status{
    color: rgba(255,77,109,.95);
    border-color: rgba(255,77,109,.22);
    background: rgba(255,77,109,.08);
  }

  .footer{
    padding: 10px 12px 12px 12px;
    border-top: 1px solid rgba(255,255,255,.07);
    color: var(--muted);
    font-size: 11px;
    display:flex;
    justify-content:space-between;
    gap:10px;
    background: transparent;
  }
</style>
</head>

<body>
<div class="wrap">
  <div class="panel">
    <div class="header">
      <div class="title">
        <h1>Trading Sessions</h1>
        <p>Live status + countdown (shown in your time: ET)</p>
      </div>
      <div class="chip" id="etNow">ET --:--:--</div>
    </div>

    <div class="grid" id="grid"></div>

    <div class="footer">
      <div>Read: <span class="pill">Your time (ET)</span></div>
      <div id="nextGlobal">Next: <span class="pill">--</span></div>
    </div>
  </div>
</div>

<script>
  const USER_TZ = "America/Toronto"; // your time (Mississauga)

  // Define sessions in each session's LOCAL time
  const SESSIONS = [
    { key:"asia",   name:"Asia",     city:"Tokyo",    tz:"Asia/Tokyo",        start:"07:00", end:"16:00" },
    { key:"london", name:"London",   city:"London",   tz:"Europe/London",     start:"08:00", end:"17:00" },
    { key:"ny",     name:"New York", city:"New York", tz:"America/New_York",  start:"08:00", end:"17:00" }
  ];

  const grid = document.getElementById("grid");
  const pad = n => String(n).padStart(2,"0");
  const parseHM = hm => { const [h,m]=hm.split(":").map(Number); return h*60+m; };

  function hhmmssInTZ(tz, d=new Date()){
    const t = new Intl.DateTimeFormat("en-GB", {
      timeZone: tz, hour12:false,
      hour:"2-digit", minute:"2-digit", second:"2-digit"
    }).format(d);
    return t; // "HH:MM:SS"
  }

  function hhmmInTZ(tz, d=new Date()){
    return new Intl.DateTimeFormat("en-GB", {
      timeZone: tz, hour12:false, hour:"2-digit", minute:"2-digit"
    }).format(d);
  }

  function minsSinceMidnightInTZ(tz, d=new Date()){
    const t = new Intl.DateTimeFormat("en-GB", {
      timeZone: tz, hour12:false, hour:"2-digit", minute:"2-digit"
    }).format(d);
    const [HH,MM]=t.split(":").map(Number);
    return HH*60 + MM;
  }

  function formatDuration(ms){
    const total = Math.max(0, Math.floor(ms/1000));
    const h = Math.floor(total/3600);
    const m = Math.floor((total%3600)/60);
    const s = total%60;
    return h>0 ? `${h}h ${pad(m)}m ${pad(s)}s` : `${m}m ${pad(s)}s`;
  }

  function isOpen(session){
    const nowM = minsSinceMidnightInTZ(session.tz);
    const startM = parseHM(session.start);
    const endM = parseHM(session.end);

    if(endM > startM) return (nowM >= startM && nowM < endM);
    return (nowM >= startM || nowM < endM); // if crosses midnight
  }

  // Find next open/close as real timestamps (DST safe)
  function nextEvent(session){
    const startM = parseHM(session.start);
    const endM = parseHM(session.end);
    const now = new Date();

    let nextOpen = null;
    let nextClose = null;

    for(let i=0; i<=48*60; i++){
      const probe = new Date(now.getTime() + i*60*1000);
      const m = minsSinceMidnightInTZ(session.tz, probe);
      if(!nextOpen && m === startM) nextOpen = probe.getTime();
      if(!nextClose && m === endM) nextClose = probe.getTime();
      if(nextOpen && nextClose) break;
    }

    const openNow = isOpen(session);
    const when = openNow ? nextClose : nextOpen;
    return { openNow, when, type: openNow ? "closes" : "opens", nextOpen, nextClose };
  }

  function build(){
    grid.innerHTML = "";
    for(const s of SESSIONS){
      const el = document.createElement("div");
      el.className = "card closed";
      el.id = `card-${s.key}`;
      el.innerHTML = `
        <div class="top">
          <div class="left">
            <div class="dot"></div>
            <div class="names">
              <b>${s.name} Session</b>
              <span>${s.city} · ${s.start}–${s.end} (local)</span>
            </div>
          </div>
          <div class="status" id="status-${s.key}">CLOSED</div>
        </div>

        <div class="mid">
          <div class="clock" id="clock-${s.key}">--:--:--</div>
          <div class="cd">
            <div id="label-${s.key}">Next: --</div>
            <div class="big" id="cd-${s.key}">--</div>
          </div>
        </div>

        <div class="windows">
          <div class="line">
            <div>Your time (ET)</div>
            <span class="pill" id="your-${s.key}">--</span>
          </div>
          <div class="line">
            <div>${s.city} local</div>
            <span class="pill" id="local-${s.key}">${s.start}–${s.end}</span>
          </div>
        </div>
      `;
      grid.appendChild(el);
    }
  }

  function tick(){
    // Live ET clock in header
    document.getElementById("etNow").textContent = `ET ${hhmmssInTZ(USER_TZ)}`;

    let global = null;

    for(const s of SESSIONS){
      // Live ET clock inside each card (keeps it simple & clear)
      document.getElementById(`clock-${s.key}`).textContent = hhmmssInTZ(USER_TZ);

      const ev = nextEvent(s);
      const card = document.getElementById(`card-${s.key}`);
      card.classList.toggle("open", ev.openNow);
      card.classList.toggle("closed", !ev.openNow);

      document.getElementById(`status-${s.key}`).textContent = ev.openNow ? "OPEN" : "CLOSED";
      document.getElementById(`label-${s.key}`).textContent = `Next: ${ev.type.toUpperCase()}`;
      document.getElementById(`cd-${s.key}`).textContent = formatDuration(ev.when - Date.now());

      // Show the session window in YOUR time (ET) using the next open & close timestamps
      if(ev.nextOpen && ev.nextClose){
        const yourStart = hhmmInTZ(USER_TZ, new Date(ev.nextOpen));
        const yourEnd   = hhmmInTZ(USER_TZ, new Date(ev.nextClose));
        document.getElementById(`your-${s.key}`).textContent = `${yourStart}–${yourEnd}`;
      }

      if(!global || ev.when < global.when){
        global = { when: ev.when, text: `${s.name} ${ev.type}` };
      }
    }

    if(global){
      document.getElementById("nextGlobal").innerHTML =
        `Next: <span class="pill">${global.text}</span> <span class="pill">${formatDuration(global.when - Date.now())}</span>`;
    }
  }

  build();
  tick();
  setInterval(tick, 1000);
</script>
</body>
</html>
