<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Killzone Session Monitor</title>

<style>
  :root{
    --text: rgba(255,255,255,.92);
    --muted: rgba(255,255,255,.60);
    --stroke: rgba(255,255,255,.10);

    --open: #28E6A5;
    --closed:#FF4D6D;

    /* Change this if you want more/less “glass” */
    --card: rgba(0,0,0,.24);

    --radius: 16px;
    --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
    --sans: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
  }

  *{ box-sizing:border-box; }

  /* Force TRUE transparency inside Notion iframe */
  html, body{
    margin:0;
    padding:0;
    background: transparent !important;
  }

  body{
    color: var(--text);
    font-family: var(--sans);
    padding: 12px;
  }

  .wrap{
    width: min(980px, 100%);
    margin: 0 auto;
  }

  .panel{
    background: transparent !important;
    border: 1px solid var(--stroke);
    border-radius: var(--radius);
    overflow:hidden;
  }

  .header{
    display:flex;
    justify-content:space-between;
    align-items:flex-start;
    gap:12px;
    padding: 12px;
    border-bottom: 1px solid rgba(255,255,255,.07);
    background: transparent;
  }

  .title h1{
    margin:0;
    font-size: 14px;
    font-weight: 800;
    letter-spacing:.2px;
  }
  .title p{
    margin:4px 0 0 0;
    font-size: 12px;
    color: var(--muted);
  }

  .chip{
    font-family: var(--mono);
    font-size: 12px;
    color: rgba(255,255,255,.82);
    padding: 7px 10px;
    border-radius: 999px;
    border:1px solid rgba(255,255,255,.12);
    background: rgba(0,0,0,.22);
    white-space:nowrap;
  }

  .grid{
    display:grid;
    grid-template-columns: repeat(3, minmax(0, 1fr));
    gap: 10px;
    padding: 12px;
  }

  @media (max-width: 760px){
    .grid{ grid-template-columns: 1fr; }
  }

  .card{
    border: 1px solid rgba(255,255,255,.10);
    border-radius: 14px;
    padding: 12px;
    background: var(--card);
    backdrop-filter: blur(10px);
    -webkit-backdrop-filter: blur(10px);
  }

  .top{
    display:flex;
    justify-content:space-between;
    align-items:center;
    gap:10px;
  }

  .left{
    display:flex;
    align-items:center;
    gap:10px;
    min-width:0;
  }

  .dot{
    width:10px; height:10px;
    border-radius:50%;
    background: var(--closed);
    box-shadow: 0 0 0 4px rgba(255,77,109,.14);
    flex:0 0 auto;
  }

  .names{
    display:flex;
    flex-direction:column;
    gap:2px;
    min-width:0;
  }
  .names b{
    font-size:13px;
    white-space:nowrap;
    overflow:hidden;
    text-overflow:ellipsis;
  }
  .names span{
    font-size:11px;
    color: var(--muted);
    white-space:nowrap;
    overflow:hidden;
    text-overflow:ellipsis;
  }

  .status{
    font-family: var(--mono);
    font-size: 11px;
    padding: 6px 10px;
    border-radius: 999px;
    border:1px solid rgba(255,255,255,.12);
    background: rgba(0,0,0,.22);
    white-space:nowrap;
  }

  .mid{
    display:flex;
    justify-content:space-between;
    align-items:flex-end;
    gap: 10px;
    margin-top: 12px;
  }

  .clock{
    font-family: var(--mono);
    font-size: 26px;
    letter-spacing:.4px;
    line-height:1;
  }

  .cd{
    text-align:right;
    color: var(--muted);
    font-size: 11px;
    line-height:1.35;
  }
  .cd .big{
    margin-top: 2px;
    font-family: var(--mono);
    color: rgba(255,255,255,.88);
    font-size: 12px;
  }

  .open .dot{
    background: var(--open);
    box-shadow: 0 0 0 4px rgba(40,230,165,.14);
  }
  .open .status{
    color: rgba(40,230,165,.95);
    border-color: rgba(40,230,165,.22);
    background: rgba(40,230,165,.10);
  }
  .closed .status{
    color: rgba(255,77,109,.95);
    border-color: rgba(255,77,109,.22);
    background: rgba(255,77,109,.08);
  }

  .footer{
    padding: 10px 12px 12px 12px;
    border-top: 1px solid rgba(255,255,255,.07);
    color: var(--muted);
    font-size: 11px;
    display:flex;
    justify-content:space-between;
    gap:10px;
    background: transparent;
  }

  .pill{
    font-family: var(--mono);
    padding: 2px 8px;
    border-radius: 999px;
    border:1px solid rgba(255,255,255,.10);
    background: rgba(0,0,0,.18);
    color: rgba(255,255,255,.70);
    display:inline-block;
    white-space:nowrap;
  }
</style>
</head>

<body>
<div class="wrap">
  <div class="panel">
    <div class="header">
      <div class="title">
        <h1>Killzone Monitor</h1>
        <p>Asia Range · London Killzone · NY Killzone (ET)</p>
      </div>
      <div class="chip" id="etNow">ET --:--:--</div>
    </div>

    <div class="grid" id="grid"></div>

    <div class="footer">
      <div>Status is based on <span class="pill">your time (ET)</span></div>
      <div id="nextGlobal">Next: <span class="pill">--</span></div>
    </div>
  </div>
</div>

<script>
  // Your timezone (Mississauga)
  const USER_TZ = "America/Toronto";

  // Killzones you requested (ET):
  // Asia Range: 8:00 PM – 12:00 AM
  // London Killzone: 2:00 AM – 5:00 AM
  // NY Killzone: 9:30 AM – 11:00 AM
  //
  // Note: "end" can cross midnight (Asia ends at 00:00)
  const WINDOWS = [
    { key:"asia",   name:"Asia Range",       start:"20:00", end:"00:00" },
    { key:"london", name:"London Killzone",  start:"02:00", end:"05:00" },
    { key:"ny",     name:"NY Killzone",      start:"09:30", end:"11:00" }
  ];

  const grid = document.getElementById("grid");
  const pad = n => String(n).padStart(2,"0");

  function parseHM(hm){
    const [h,m] = hm.split(":").map(Number);
    return h*60 + m;
  }

  function hhmmssInTZ(tz, d=new Date()){
    return new Intl.DateTimeFormat("en-GB", {
      timeZone: tz, hour12:false,
      hour:"2-digit", minute:"2-digit", second:"2-digit"
    }).format(d);
  }

  function hhmmInTZ(tz, d=new Date()){
    return new Intl.DateTimeFormat("en-GB", {
      timeZone: tz, hour12:false, hour:"2-digit", minute:"2-digit"
    }).format(d);
  }

  function minsInTZ(tz, d=new Date()){
    const t = hhmmInTZ(tz, d);
    const [HH,MM] = t.split(":").map(Number);
    return HH*60 + MM;
  }

  function formatDuration(ms){
    const total = Math.max(0, Math.floor(ms/1000));
    const h = Math.floor(total/3600);
    const m = Math.floor((total%3600)/60);
    const s = total%60;
    return h>0 ? `${h}h ${pad(m)}m ${pad(s)}s` : `${m}m ${pad(s)}s`;
  }

  function isOpen(win){
    const nowM = minsInTZ(USER_TZ);
    const startM = parseHM(win.start);
    const endM = parseHM(win.end);

    // If end > start: same day window
    if(endM > startM) return (nowM >= startM && nowM < endM);

    // Crosses midnight (e.g., 20:00 -> 00:00)
    // Open if now >= start OR now < end
    return (nowM >= startM || nowM < endM);
  }

  // Find next occurrence of a minute-of-day in USER_TZ as a real timestamp (DST-safe).
  function nextOccurrence(minuteOfDay){
    const now = new Date();
    for(let i=0; i<=48*60; i++){
      const probe = new Date(now.getTime() + i*60*1000);
      if(minsInTZ(USER_TZ, probe) === minuteOfDay) return probe.getTime();
    }
    return null;
  }

  function nextEvent(win){
    const startM = parseHM(win.start);
    const endM   = parseHM(win.end);

    const nextOpen  = nextOccurrence(startM);
    const nextClose = nextOccurrence(endM);

    const openNow = isOpen(win);

    // If currently open, next event is close; otherwise open
    const when = openNow ? nextClose : nextOpen;
    const type = openNow ? "closes" : "opens";

    return { openNow, when, type, nextOpen, nextClose };
  }

  function build(){
    grid.innerHTML = "";
    for(const w of WINDOWS){
      const el = document.createElement("div");
      el.className = "card closed";
      el.id = `card-${w.key}`;
      el.innerHTML = `
        <div class="top">
          <div class="left">
            <div class="dot"></div>
            <div class="names">
              <b>${w.name}</b>
              <span>${w.start}–${w.end} (ET)</span>
            </div>
          </div>
          <div class="status" id="status-${w.key}">CLOSED</div>
        </div>

        <div class="mid">
          <div class="clock" id="clock-${w.key}">--:--:--</div>
          <div class="cd">
            <div id="label-${w.key}">Next: --</div>
            <div class="big" id="cd-${w.key}">--</div>
          </div>
        </div>
      `;
      grid.appendChild(el);
    }
  }

  function tick(){
    // Header live time
    document.getElementById("etNow").textContent = `ET ${hhmmssInTZ(USER_TZ)}`;

    let global = null;

    for(const w of WINDOWS){
      // Live ET clock on each card
      document.getElementById(`clock-${w.key}`).textContent = hhmmssInTZ(USER_TZ);

      const ev = nextEvent(w);
      const card = document.getElementById(`card-${w.key}`);
      card.classList.toggle("open", ev.openNow);
      card.classList.toggle("closed", !ev.openNow);

      document.getElementById(`status-${w.key}`).textContent = ev.openNow ? "OPEN" : "CLOSED";
      document.getElementById(`label-${w.key}`).textContent  = `Next: ${ev.type.toUpperCase()}`;

      if(ev.when){
        document.getElementById(`cd-${w.key}`).textContent = formatDuration(ev.when - Date.now());
        if(!global || ev.when < global.when){
          global = { when: ev.when, text: `${w.name} ${ev.type}` };
        }
      }else{
        document.getElementById(`cd-${w.key}`).textContent = "--";
      }
    }

    if(global){
      document.getElementById("nextGlobal").innerHTML =
        `Next: <span class="pill">${global.text}</span> <span class="pill">${formatDuration(global.when - Date.now())}</span>`;
    }
  }

  build();
  tick();
  setInterval(tick, 1000);
</script>
</body>
</html>
